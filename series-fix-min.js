!function(){"use strict";function t(t){if(!t)return-1;var e=new Date(t),n=new Date;e.setHours(0,0,0,0),n.setHours(0,0,0,0);var a=e-n;return Math.ceil(a/864e5)}function e(t,e,n){var a=t.querySelector(".card__view");if(a){var i=t.querySelector(".ep-watched-layer");if(i&&i.remove(),e&&e.length){var r=document.createElement("div");r.className="ep-watched-layer",n&&r.classList.add("layer--movie");var o=document.createElement("div");o.className="ep-watched-body",e.forEach((function(t){var e=document.createElement("div");e.className="ep-watched-item"+(t.isMovie?" movie-variant":"");var n=document.createElement("span");if(n.innerHTML=t.title,e.appendChild(n),t.percent>0){var a=document.createElement("div");a.className="ep-time-line";var i=document.createElement("div");i.style.width=t.percent+"%",a.appendChild(i),e.appendChild(a)}o.appendChild(e)})),r.appendChild(o),a.appendChild(r)}}}function n(n,a){var i=function(t){var e=Lampa.Utils,n=Lampa.Storage,a=Lampa.Timeline,i=[t.original_title,t.original_name,t.name].filter(Boolean),r=[];i.forEach((function(t){(function(t){if(!t)return[];var e=[t],n=t.match(/[A-Z]{2,}/g);n&&n.forEach((function(n){var a=n.split("").join("・");e.push(t.replace(n,a));var i=n.split("").join(".");e.push(t.replace(n,i)),e.push(t.replace(n,i+"."))}));var a={"!":"！","！":"!","?":"？","？":"?"},i=[];return e.forEach((function(t){var e=t.split("").map((function(t){return a[t]||t})).join("");e!==t&&i.push(e)})),e.concat(i)})(t).forEach((function(t){-1===r.indexOf(t)&&r.push(t)}))}));var o=n.get("online_watched_last","{}"),c=null,d=null;if(r.some((function(t){var n=e.hash(t);if(o[n])return c=o[n],d=t,!0})),!c&&t.id&&Object.keys(o).some((function(e){var n=o[e];if(n&&n.id==t.id)return c=n,d=n.title||n.name||n.original_title||n.original_name,!0})),c)return{season:c.season,episode:c.episode,title:d||i[0]};if(i[0]){var s=e.hash([1,1,i[0]].join("")),l=a.view(s);if(l&&l.percent>1)return{season:1,episode:1,title:i[0]}}return null}(a);i&&function(t,e,n){if(!Lampa.Api||!Lampa.Api.seasons)return n([]);Lampa.Api.seasons(t,[e],(function(t){t&&t[e]&&t[e].episodes?n(t[e].episodes):n([])}),(function(){n([])}))}(a,i.season,(function(r){var o=r.findIndex((function(t){return t.episode_number==i.episode}));if(-1!==o){var c=r[o+1],d=[];(c?t(c.air_date):-1)>0?(d.push(r[o]),d.push(c)):d=r.slice(o,o+5);var s=d.map((function(e,n){var r=0===n,o=0,c=t(e.air_date),d=c>0,s=(e.name||"").replace(new RegExp("^"+e.episode_number+"([ .-]|$)"),"").trim();if(s&&s!==Lampa.Lang.translate("noname")||(s=""),d)if(c>=365)s="Осталось лет: "+Math.floor(c/365);else if(c>=30){s="Осталось месяцев: "+Math.floor(c/30)}else if(c>=7){s="Осталось недель: "+Math.floor(c/7)}else s="Осталось дней: "+c;var l='<span class="ep-num">'+e.episode_number+" -</span> "+s;if(r&&!d){var p=i.title||a.original_title||a.original_name||a.name,m=[e.season_number,e.season_number>10?":":"",e.episode_number,p].join(""),u=Lampa.Timeline.view(Lampa.Utils.hash(m));u&&(o=u.percent)}return{title:l,percent:o,isMovie:!1}}));e(n,s,!1)}}))}function a(t,a){void 0!==a.number_of_seasons&&a.number_of_seasons>0||a.original_name?n(t,a):function(t,n){var a=Lampa.Utils,i=Lampa.Timeline,r=Lampa.Lang,o=n.original_title||n.title;if(o){var c=i.view(a.hash(o));c&&c.percent&&e(t,[{title:r.translate("title_viewed")+" "+(c.time&&c.time>0?a.secondsToTimeHuman(c.time):c.percent+"%"),percent:c.percent,isMovie:!0}],!0)}}(t,a)}function i(){!function(){if(!document.getElementById("ep-design-css")){var t=document.createElement("style");t.id="ep-design-css",t.innerHTML='\n\t\t\t.card .card-watched { display: none !important; }\n\n\t\t\t.ep-watched-layer {\n\t\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\t\tleft: 0.4em;\n\t\t\t\t\t\t\tright: 0.4em;\n\t\t\t\t\t\t\tbottom: 2.7em;\n\t\t\t\t\t\t\tz-index: 2;\n\n\t\t\t\t\t\t\tbackground-color: rgba(0, 0, 0, 0.9);\n\t\t\t\t\t\t\tborder-radius: 1em;\n\t\t\t\t\t\t\tpadding: 0.6em 1em 1em 1em;\n\t\t\t\t\t\t\tmin-width: 13em;\n\t\t\t\t\t\t\tfont-family: "SegoeUI", sans-serif;\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\tflex-direction: column;\n\t\t\t\t\t\t\tpointer-events: none;\n\t\t\t\t\t\t\toverflow: hidden;\n\n\t\t\t\t\t\t\topacity: 0;\n\t\t\t\t\t\t\ttransition: opacity 0.2s ease;\n\t\t\t}\n\n\t\t\t.card.focus .ep-watched-layer,\n\t\t\t.card:hover .ep-watched-layer {\n\t\t\t\t\t\t\topacity: 1;\n\t\t\t\t\t\t\ttransition-delay: 0.5s;\n\t\t\t}\n\n\t\t\t.ep-watched-body {\n\t\t\t\t\t\t\tfont-size: 0.9em;\n\t\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\t\tflex-direction: column;\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t}\n\n\t\t\t.ep-watched-item {\n\t\t\t\t\t\t\tmargin-top: 0.3em;\n\t\t\t\t\t\t\tline-height: 1.6;\n\t\t\t}\n\n\t\t\t.ep-watched-item.is-active {\n\t\t\t\t\t\t\tmargin-top: 0;\n\t\t\t\t\t\t\tcolor: #fff;\n\t\t\t}\n\t\t\t.ep-watched-item:nth-child(2) { color: #9f9f9f; }\n\t\t\t.ep-watched-item:nth-child(3) { color: #6c6c6c; }\n\t\t\t.ep-watched-item:nth-child(4) { color: #5e5e5e; }\n\t\t\t.ep-watched-item:nth-child(5) { color: #4c4c4c; }\n\n\t\t\t.ep-watched-item.movie-variant {\n\t\t\t\t\t\t\tfont-size: 1em;\n\t\t\t\t\t\t\tmargin-top: 0;\n\t\t\t\t\t\t\tcolor: #fff;\n\t\t\t\t\t\t\ttext-align: left;\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t}\n\n\t\t\t.ep-watched-item > span {\n\t\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\t\t\t\twhite-space: nowrap;\n\t\t\t}\n\n\t\t\t.ep-time-line {\n\t\t\t\t\t\t\tmargin-top: 0.5em;\n\t\t\t\t\t\t\tmargin-bottom: 0.3em;\n\t\t\t\t\t\t\tborder-radius: 3em;\n\t\t\t\t\t\t\tbackground-color: rgba(255, 255, 255, 0.25);\n\t\t\t\t\t\t\theight: 0.3em;\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\toverflow: hidden;\n\t\t\t}\n\n\t\t\t.ep-time-line > div {\n\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t\tborder-radius: 3em;\n\t\t\t\t\t\t\tbackground-color: #fff;\n\t\t\t}\n\n\t\t\t.ep-num {\n\t\t\t\t\t\t\tfont-weight: 600;\n\t\t\t}\n        ',document.head.appendChild(t)}}();var t=function(t){if(!t.dataset.epDesignProcessed){var e=t.data||window.jQuery&&window.jQuery(t).data("data")||t.card_data;e&&(t.dataset.epDesignProcessed="true",a(t,e),t.addEventListener("mouseenter",(function(){a(t,e)})))}};new MutationObserver((function(e){e.forEach((function(e){e.addedNodes.forEach((function(e){1===e.nodeType&&(e.classList.contains("card")?t(e):e.querySelectorAll(".card").forEach(t))}))}))})).observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll(".card").forEach(t)}window.appready?i():Lampa.Listener.follow("app",(function(t){"ready"==t.type&&i()}))}();
